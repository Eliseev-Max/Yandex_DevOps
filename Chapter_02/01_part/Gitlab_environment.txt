Окружение и развертывание (Environments and deployments)
{https://docs.gitlab.com/ee/ci/environments/}

Окружения описывают места развёртывания кода.

GitLab:
  • предоставляет полную историю развертываний в каждой среде.
  • отслеживает ваши развертывания, поэтому мы всегда знаем, что развернуто на наших серверах.

Где можно увидеть список окружений:
  • на странице обзора проекта (если хотя бы одна среда доступна (то есть не остановлена))
  • на левой боковой панели: Deployments → Environments

Типы окружений:
	♦ статические (static)
	  ○ обычно повторно используется при последующих развертываниях;
      ○ имеют статическое имя - например, staging или production;
      ○ создаются вручную или как часть конвейера CI/CD.

	♦ динамические(dynamic)
	  ○ обычно создаются в конвейере CI/CD и используются только для одного развертывания, а затем либо останавливаются, либо удаляются;
      ○ имеют динамическое имя, обычно основанное на значении переменной CI/CD;
	  ○ особенность обзорных приложений


Создание статического окружения
	Можно создать:
	  • в UI GitLab;
	  • в файле .gitlab-ci.yml
	
	Создать в UI:
	‼ нужно иметь роль не ниже роли Разработчика (Developer)
	  1. (в верхней панели): Main Menu → Projects → <Свой проект>
	  2. (на левой боковой панели): Deployments → Environments
	  3. New environmen
	  4. (заполнить поля)
	  5. [Сохранить]
	
	Создать в .gitlab-ci.yml:
	‼ нужно иметь роль не ниже роли Разработчика (Developer)
	  1. определить задание (job) на этапе развёртывания (deploy stage)
	  2. в задании: определить
	    → environmen name
		→ URL
		Если среда с таким именем не существует на момент запуска конвейера, она будет создана.
	‼ Некоторые символы нельзя использовать в именах окружений.
	(Информация о ключевых словах окружения: https://docs.gitlab.com/ee/ci/yaml/index.html#environment)
	
	Пример:
deploy_staging:
  stage: deploy
  script:
    - echo "Deploy to staging server"
  environment:
    name: staging
    url: https://staging.example.com

	
Создание динамического окружения
	Для создания динамической среды используются переменные CI/CD, УНИКАЛЬНЫЕ для каждого конвейера.
	‼ нужно иметь роль не ниже роли Разработчика (Developer)
	
	Создать в .gitlab-ci.yml:
	  1. определить задание (job) на этапе развёртывания (deploy stage);
	  2. В задании определите следующие атрибуты среды:
	      ○ имя (name) - используйте связанную CI/CD переменную, например $CI_COMMIT_REF_SLUG.
		    По желанию добавьте к имени окружения статический префикс, который группирует в пользовательском интерфейсе все окружения с таким же префиксом.
			
          ○ url: (необязательно). Префикс имени хоста с соответствующей CI/CD-переменной, например $CI_ENVIRONMENT_SLUG.
	  
	  В следующем примере при каждом запуске задания deploy_review_app имя и URL среды определяются с помощью уникальных значений.

deploy_review_app:
  stage: deploy
  script: make deploy
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    url: https://$CI_ENVIRONMENT_SLUG.example.com
  only:
    - branches
  except:
    - main




{ # Кусок pipeline
script:
  - echo "BE_JOB_ID=$CI_JOB_ID" > backend_job_id.env
artifacts:
  paths:
    - path/to/the/files
  reports:
    dotenv: backend_job_id.env
}
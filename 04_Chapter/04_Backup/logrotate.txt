Утилита Logrotate
  - ротирует, сжимает и отправляет по почте системные журналы.
  - предназначена для автоматизации обработки журналов.

{ sources:
  https://www.opennet.ru/man.shtml?topic=logrotate&category=8&russian=0
  https://manpages.ubuntu.com/manpages/focal/en/man8/logrotate.8.html
  https://www.8host.com/blog/upravlenie-logami-s-pomoshhyu-logrotate-v-ubuntu/

}

Пример действий, которые могут быть выполнены над журналами утилитой logrotate:
  • сжатие журналов в архив;
  • отправка журналов на другой сервер
  Условия (триггеры) для выполнения действия:
    - достижение определённого размера;
	- достижение определённого возраста;
	- другие параметры.

Проверку условий можно настроить
  - ежедневно,
  - еженедельно 
  - или ежемесячно.
  Это позволяет создать схему ротации логов, удобную именно для вас и вашего сервера.

Logrotate - это популярная утилита → в большинстве дистрибутивов Linux она поставляется по умолчанию.

Где располагаются настройки утилиты:
  ♦ основные - в файле /etc/logrotate.conf
  ♦ дополнительные - в папке  /etc/logroate.d/

Чтобы конфигурационные файлы из этой папки загружались программой, необходимо добавить в основной конфигурационный файл такую строчку:
# в файле /etc/logroate.conf
include /etc/logrotate.d

Настройка частоты выполнения проверки совпадению условий:
  директивы:
    • hourly - каждый час;
    • daily - каждый день;
    • weekly - каждую неделю;
    • monthly - каждый месяц;
    • yearly - каждый год.

Основные директивы управления и обработки логов:

  • rotate - указывает сколько старых логов нужно хранить, в параметрах передается количество;
  • create - указывает, что необходимо создать пустой лог файл после перемещения старого;
  • dateext - добавляет дату ротации перед заголовком старого лога;
  • compress - указывает, что лог необходимо сжимать;
  • delaycompress - не сжимать последний и предпоследний журнал;
  • extension - сохранять оригинальный лог файл после ротации, если у него указанное расширение;
  • mail - отправлять Email после завершения ротации;
  • maxage - выполнять ротацию журналов, если они старше, чем указано;
  • missingok - не выдавать ошибки, если лог файла не существует;
  • olddir - перемещать старые логи в отдельную папку;
  • postrotate/endscript - выполнить произвольные команды после ротации;
  • start - номер, с которого будет начата нумерация старых логов;
  • size - размер лога, когда он будет перемещен;

Каждый лог, который подлежит ротации описывается таким образом:
  адрес_файла_лога {
  директивы
  }

Пример: настроим ротацию лога
  1. создадим в директории /etc/logroate.d/ конфигурационный файл rsyslog.conf
  2. в созданном конфигурационном файле зададим настройки:

/var/log/messages {
daily						# выполнять ротацию журналов ежедневно
rotate 3					# хранить 3 последних журнала, более старые экземпляры удалять
size 10M					# пороговое значение для ротации - 10Мб (меньше не ротируется)
compress					# будет исполльзовано сжатие для всех журналов,... 
delaycompress				# ...кроме последнего и предпоследнего
}

# delaycompress:
  Отложить сжатие предыдущего файла журнала до следующего цикла ротации.
  Действует только в сочетании с compress.
  Это может быть использовано, когда какой-либо программе нельзя сказать, чтобы она закрыла свой лог-файл,
  и поэтому она может продолжать писать в предыдущий лог-файл в течение некоторого времени.

Для тестирования работы конфигурации запустим утилиту logrotate с опцией -d.
Она выведет все, что планируется сделать, но не будет изменять файлы на диске.

  -d
    включает режим отладки, который означает, что в журналы не вносятся изменения и файл состояния файл состояния logrotate не обновляется.
    Печатаются только отладочные сообщения.
	В режиме отладки автоматически включена опция -v (действия программы сопровождаются выводом подробной информации).

---
create [mode] <owner> <group>, create <owner> <group>
Сразу после ротации (до запуска сценария postrotate) создается файл журнала (с тем же именем, что и только что ротированный файл журнала).
  • mode задает режим для файла журнала в восьмеричном исчислении (такой же, как chmod(2)),
  • owner задает имя пользователя, которому будет принадлежать файл журнала,
  • group задает группу, к которой будет принадлежать файл журнала.
  
Любой из атрибутов файла журнала (лога) может быть опущен,
  в этом случае для нового файла будут использоваться те же значения атрибутов, что и для исходного файла журнала.
Эта опция может быть отключена с помощью опции nocreate.